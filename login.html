<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Communications application</title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <script>
        let loggedin = localStorage.getItem("loggedin") ? JSON.parse(localStorage.getItem("loggedin")) : [];
        let users = JSON.parse(localStorage.getItem("users"))
        function validate_and_login() {

            var email = document.getElementById("email_id").value;
            var password = document.getElementById("pwd").value;

            if (email == "") {
                alert("Please enter email");
                return false;
            }
            else if (password == "") {
                alert("Please enter password");
                return false;
            }

            // Checking for the user existence
            for (let user of users) {
                if (user.email == email) {
                    if (user.password == password) {
                        // Writing to local storage
                        let userObj = {
                            email: email,
                            password: password,
                        }
                        loggedin.push(userObj); // Push item in array
                        let usersString = JSON.stringify(loggedin);
                        localStorage.setItem("loggedin", usersString); // localstorage key and value to set item
                        return true;
                    }
                    else {
                        alert("Password Incorrect!");
                        return false;
                    }
                }
            }
            alert("User doesnt Exists!");
            return false;

        }
    </script>
</head>

<body>
    <h1 class="align_centre">Login</h1>
    <div class="center">
        <!-- Login Form -->
        <form action="./login-success.html" onsubmit="return validate_and_login()">
            <table>
                <tr>
                    <td class="table_align">
                        <h3>Email</h3>
                    </td>
                    <td><input id=email_id class="input_box" type="email" placeholder="anne.hunter@mail.com"></td>
                </tr>
                <tr>
                    <td class="table_align">
                        <h3>Password
                    </td>
                    </h3>
                    <td><input id="pwd" class="input_box input" type="password" placeholder="*****"></td>
                </tr>
                <tr>
                    <td class="button_align" colspan="2">
                        <button type="Submit" class="submit_box">Login</button>
                    </td>
                </tr>
            </table>
        </form>
    </div>

</body>

</html>